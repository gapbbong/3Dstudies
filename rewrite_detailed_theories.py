import re

# Read the file
with open('d:/App/3d Studies/data_practice.js', 'r', encoding='utf-8') as f:
    content = f.read()

# Define detailed theories for each chapter (문제 풀 수 있게 상세히, 1단계 중복 제외)
theories = {
    "practice_part9b": """데이터 클리닝 (Cleaning)
- 노이즈 발생 원인: 측정 환경, 대상물 표면 상태, 스캐닝 설정
- 노이즈 제거: 자동 필터링 기능 또는 수동 제거

이동식 vs 고정식 스캐너
- 이동식: 대형 물체, 스캐너 설치 어려운 경우, 특정 부위만 측정
- 고정식에 비해 정밀도 낮음
- 정밀 측정이 필요한 곳에는 부적합

메시 종류
- 클로즈 메시: 삼각형 면의 한 모서리가 2개의 면과 공유
- 오픈 메시: 메시 사이에 한 면이 비어 있는 형상 (구멍 발생 가능)

스캐닝 설정 단계
- 스캐너 보정, 노출 설정, 측정 범위 설정
- 측정 위치 선정, 스캐닝 간격 설정, 속도 설정

정합 vs 병합
- 정합 (Registration): 점 데이터를 회전 이송하며 같은 좌표계로 통일
- 병합 (Merging): 정합 후 중복 부분을 합쳐 데이터 사이즈 축소

비접촉식 스캐너 특징
- 먼 거리 대형 구조물 측정 용이
- 투명/반사 물체는 측정 어려움 (유리, 거울 등)""",

    "practice_part10": """넙스 (NURBS) 모델링 심화
- 폴리곤 대비 많은 계산 필요 (렌더링 시 하이 폴리곤 전환)
- 서피스 모델링 기반 (무게 계산 불가, 솔리드만 가능)
- 수학 함수로 곡면 표현, 부드러운 곡선 모델링
- 삼각형이 아닌 제어점으로 형상 제어
- 산업디자인, 자동차, 비행기 표면 설계에 효과적

폴리곤 모델링 비교
- 폴리곤: 삼각형 기본 단위, 계산 적음, 곡선 표현 부족
- 넙스: 곡면 우수, 계산 많음, 치수 정확

서피스 모델링
- 곡면 모델링, 표면 데이터만 존재
- 컴퓨터 속도/메모리 적게 사용
- 솔리드로 표현 어려운 기하 곡면 모델링

솔리드 모델링 작업 순서
- 스케치 작성 → 대략적 2D 단면 그리기 → 구속 조건 부여 → 치수 기입 → 베이스 피처 작성

오류 수정 프로세스
- 치명적 오류 없음: 자동 오류 수정
- 자동 수정 후 남은 오류: 수동 오류 수정
- 치명적 오류 있음: 원본 모델링 파일로 수정

오류 검출 프로그램
- 넷팹 (NETFABB), 메시믹서 (MESHMIXER), 메시랩 (MESHLAB)
- 카티아 (CATIA)는 CAD 설계 프로그램 (오류 검출 아님)

분할 출력
- 최대 출력 사이즈보다 큰 경우 분할
- 합치기 편한 곳으로 분할
- 지지대 최소화, 조립/동작 고려

3D 모델링 기능
- 구멍 (Hole): 2D 스케치 없이 3D 형상에 직접 구멍 생성
- 필렛 (Fillet): 모서리 둥글게 (라운딩)
- 모따기 (Chamfer): 모서리 사선으로 따냄
- 이력 (History): 작업 내용을 순서/항목별로 정렬
- 스케치 후 치수 수정 가능
- 곡면 모델링: 가상 평면으로 스케치 면 설정
- 스케치는 평면에서만 가능 (곡면 불가)

삼각형 메시 생성 법칙 위배
- 삼각형 없는 부분 (구멍)
- 삼각형 겹침
- 꼭짓점 연결 안 됨
- 삼각형 교차""",

    "practice_part11a_1": """제도 일반 (1단계 보충)

해칭 (Hatching)
- 45° 가는 실선으로 절단면 표시 (반드시 45°는 아님)
- 스머징 (Smudging): 단면 큰 경우 색칠로 표시

선의 종류 (1단계 보충)
- 절단선: 가는 1점 쇄선 + 굵은 실선
- 외형선: 굵은 실선
- 치수선, 해칭선, 치수보조선: 가는 실선

치수 기입
- 중복 치수 기입 금지
- 참고 치수: ( ) 괄호로 표시
- C: 45° 모따기 (예: 2-C10은 모따기 2개)
- R: 반지름
- SR: 구의 반지름

템플릿 (Template)
- 레이어, 치수 스타일, 로고, 단위 등 미리 설정
- 필요할 때 불러서 사용하는 도면 양식

2D 스케치 명령어
- 자르기 (Trim): 원을 호로 수정
- 연장 (Extend)
- 분할 (Divide)
- 생성은 수정 명령어 아님

스윕 (SWEEP) 모델링
- 단면 곡선 + 가이드 곡선 필요
- 경로를 따라 단면 이동""",

    "practice_part11a_2": """제도 응용 (1단계 Part 3 심화)

기하공차 기호
- 평면도: ▱
- 평행도: //
- 직각도: ⊥
- 위치도: ⊕
- 원통도: /○/

구속조건
- 일치, 접촉, 오프셋
- 동심, 직각, 접선, 평행

치수 기입 심화
- 이론적으로 정확한 치수: □ 사각 테두리
- 참고 치수: ( ) 괄호
- 중복 치수 회피""",

    "practice_part11b": """슬라이싱 (1단계 Part 4 심화)

G-code 추가
- G20: 인치 단위
- G21: 밀리미터 (mm) 단위
- G28: 원점 복귀 (Homing)
- G90: 절대 좌표
- G91: 상대 좌표

M-code 추가
- M104: 노즐 온도 설정
- M109: 노즐 온도 설정 후 대기
- M140: 베드 온도 설정
- M190: 베드 온도 설정 후 대기
- M106: 쿨링팬 ON
- M107: 쿨링팬 OFF

출력 보조물
- Skirt: 압출기 내부 재료 채움 (안착 목적 아님)
- Brim: 바닥 테두리 확장 (안착 도움)
- Raft: 바닥 받침대 (안착 도움)
- Bed Heating, Bed Leveling: 안착 도움""",

    "practice_part12": """출력 관련 심화

Retraction (역회전)
- 노즐 이동 시 필라멘트 뒤로 빼기
- String (거미줄) 현상 방지

출력 문제
- 노즐-플랫폼 거리 너무 가까움: 노즐 막힘, 압출 어려움
- 노즐-플랫폼 거리 너무 멀음: 재료 흘러내림
- 플랫폼 상하 움직임 멈춤: 일부 층 미생성
- 헤드 너무 빠름, 타이밍 벨트 장력 높음, 스테핑 모터 회전 불량: 단면 밀림

형상 분석
- 회전 (Rotate), 확대/축소 (Scale), 이동 (Move)
- 지지대 최소화 위한 최적 자세 배치
- 형상 이상 유무 확인

데이터 수정 필요 경우
- 조립성 위한 분할
- 서포트 최소 분할
- 해상도보다 작은 크기
- 최대 출력 사이즈보다 큰 경우 (작은 경우는 수정 불필요)""",

    "practice_part13": """후가공

퍼티 (Putty) 종류
- 1액형: 경화제 없음, 경화 속도 느림, 미세한 틈새 메움, FDM 출력물 층 메우기
- 에폭시: 강한 강도, 콘크리트 균열 보수
- 폴리에스터: 목재 가공, 프라모델, 자동차 보수 (녹색)
- 우레탄: 탄성력 우수, 방수 공사

아세톤 훈증
- 에테르 냄새 풍김 (냄새 많이 남)
- 무색 휘발성 액체
- 밀폐 용기에서 기화시켜 표면 녹임
- 매끈한 표면 얻기
- 디테일 표현 어려움

안전
- 심폐소생술 골든타임: 4분
- 4분 이내 성공 시 생존율 50% 이상
- 4분 이후 생존율 급격히 하락

전원 문제
- SMPS 고장 시: 전원 스위치 끄기 → 전원 공급 장치 수리

액체 기반 3D프린터
- 악취 발생 (두통, 메스꺼움)
- 가정용 부적합
- 의료, 치기공, 정밀 형상 제작용"""
}

# Escape and replace each theory
for chapter_id, theory_text in theories.items():
    # Escape for JavaScript
    escaped = theory_text.replace('\\', '\\\\').replace('"', '\\"').replace('\n', '\\n')
    
    # Pattern to match this chapter's theoryContent
    pattern = rf'("id":\s*"{chapter_id}"[^}}]*"theoryContent":\s*)"[^"]*(?:\\.[^"]*)*"'
    
    def replace_theory(match):
        return f'{match.group(1)}"{escaped}"'
    
    content = re.sub(pattern, replace_theory, content, count=1)

# Write back
with open('d:/App/3d Studies/data_practice.js', 'w', encoding='utf-8') as f:
    f.write(content)

print("✅ 모든 챕터 상세 이론 작성 완료!")
print("✅ Part 9B ~ Part 13 (7개 챕터)")
print("✅ 문제 풀 수 있도록 상세하게 작성")
print("✅ 1단계 중복 제거")
print("✅ 브라우저 새로고침 후 확인하세요!")
